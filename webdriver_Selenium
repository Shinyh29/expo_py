import pandas as pd
from selenium import webdriver
from selenium.webdriver.common.action_chains import ActionChains
#from selenium.webdriver.support.ui import WebDriverWait
#from selenium.webdriver.support import expected_conditions as EC
#from selenium.webdriver.common.by import By
#from selenium.common.exceptions import ElementNotVisibleException
driver = webdriver.Chrome(executable_path='C:\\chromedriver\\chromedriver.exe')
url="http://www.seibro.or.kr/websquare/control.jsp?w2xPath=/IPORTAL/user/company/BIP_CNTS01045V.xml&menuNo=284"

import time
driver.get(url)
time.sleep(4)
t_option = driver.find_element_by_xpath('//*[@id="sd1_selectbox1_input_0"]/option[2]') #기간선택옵션
t_option.click()

ActionChains(driver).move_to_element(driver.find_elements_by_class_name('w2inputCalendar_col_input')[0]).click().click().send_keys('20190201').perform()
ActionChains(driver).move_to_element(driver.find_elements_by_class_name('w2inputCalendar_col_input')[1]).click().click().send_keys('20190301').perform()
## find_elements 로 다 찾아서 [0]첫번쨰것. 서치시작~ 다음것[1] 조회끗날 

driver.find_element_by_xpath('//*[@id="image2"]').click() # 조회

time.sleep(4)


dfs = pd.DataFrame()
def frame_sele(ppath):
    global dfs
    df = pd.read_html(driver.page_source)[0]
    dfs = pd.concat([dfs,df])
    print(ppath)
    print(df)
    time.sleep(2)
    driver.find_element_by_xpath(ppath).click()
    #ActionChains(driver).move_to_element(driver.find_element_by_class_name('w2inputCalendar_col_input')).click().click().send_keys('20190301').perform()
    #더블클릭, 달력날짜값전달가능 한달씩이 최적
    
    
    
    
    
    
    
# 15 대신 충분히 큰숫자 가능. try ~ except 예외처리 했음    
try:    
    for i in range(1, 15):
        print("waiting___...%d" % i)
        ppath = '//*[@id="cntsPaging01_page_%d"]' % i
        try:
            frame_sele(ppath)
            #print(frame_sele(ppath))
            time.sleep(10)
        except Exception as ex:
            print(ex)
            time.sleep(15)
            frame_sele(ppath)    
except:
    print("")                        
                
                
                
                
"""
예외처리시도 (실패)
while 1:
    time.sleep(3)
    try:
        print(btfs(driver.page_source,'lxml').select('img')[0].get('src'))
        WebDriverWait(driver, 3).until((expected_conditions.invisibility_of_element(driver.page_source,'lxml').select('img[src=images/progress/loading.gif]')))
        next_page(ppath)
    except ElementNotVisibleException:
        print('lodging img passed')
         for i in soup.select('body img'):  
            print(i.get('alt'), i)        
     ignal = '/images/progress/loading.gif'           
     #####################찾았다###################################  대기중인 화면 로딩중 :: div 의 display:none상태로 만든다함 그것의 id값           
     btfs(driver.page_source,'lxml').select('#___processbar2_i')           
     출처 :            https://myjamong.tistory.com/54  셀레니움 대기시간 기다리기 
                
                
       
print(dfs)
# dfs  to   xlsx 
# dfs to mongodb, sql, sqlite
